(function(f){var a,e,c,d;a=function(g){if(!g.complete){return false}if(typeof g.naturalWidth!="undefined"&&g.naturalWidth==0){return false}return true};create_canvas_for=function(g){if(f.browser.msie){var h=document.createElement("canvas");h.setAttribute("width",g.width);h.setAttribute("height",g.height);G_vmlCanvasManager.initElement(h);h.getContext("2d").clearRect(0,0,h.width,h.height);return h}else{var i=f('<canvas style="width:'+g.width+"px;height:"+g.height+'px;"></canvas>').get(0);i.getContext("2d").clearRect(0,0,i.width,i.height);return i}};e={position:"absolute",left:0,top:0,padding:0,border:0};c=function(i,h,l,g,k){var j=i.getContext("2d");j.beginPath();j.moveTo(h,l);j.lineTo(g,k);j.lineWidth=2;j.closePath();j.strokeStyle="rgb(100,149,237)";j.stroke()};d=function(h,g,j){var i=h.getContext("2d");i.beginPath();i.arc(g,j,4,0,2*Math.PI,true);i.closePath();i.fillStyle="rgb(100,149,237)";i.fill()};var b={init:function(g){g=f.extend({},f.fn.imagecanvasmap.defaults,g);return this.each(function(){var p=f(this),n=p.data("imagecanvasmap");if(!n){var k=new Array();var i=new Array();if(!a(this)){return window.setTimeout(function(){p.imagecanvasmap(g)},200)}var j=f("<div></div>").css({display:"block",background:'url("'+this.src+'")',position:"relative",padding:0,width:this.width,height:this.height});j.addClass(p.attr("class"));p.before(j).css("opacity",0).css(e).remove();if(f.browser.msie){p.css("filter","Alpha(opacity=0)")}j.append(p);var m=create_canvas_for(this);f(m).css(e);m.height=this.height;m.width=this.width;p.before(m);j.click(function(t){if(!g.draw){return}var q=t.pageX-this.offsetLeft;var u=t.pageY-this.offsetTop;if(k.length>2){if(Math.abs(k[0]-q)<15&&Math.abs(i[0]-u)<15){g.draw=false;c(m,k[0],i[0],k[k.length-1],i[i.length-1]);var s="";for(var r=0;r<k.length;r++){s+=k[r]+","+i[r]+","}s=s.substr(0,s.length-1);g.onComplete(s);return}for(var r=1;r<k.length;r++){if(Math.abs(k[r]-q)<15&&Math.abs(i[r]-u)<15){return}}}else{for(var r=1;r<k.length;r++){if(Math.abs(k[r]-q)<15&&Math.abs(i[r]-u)<15){return}}}k.push(q);i.push(u);d(m,q,u);if(k.length>1){c(m,k[k.length-2],i[i.length-2],k[k.length-1],i[i.length-1])}});var o=p.get(0).getAttribute("usemap");if(o){var l=f('map[name="'+o.substr(1)+'"]');if(p.is("img")&&o&&l.size()>0){var h=l.find("area");h.each(function(){coords=this.getAttribute("coords").split(",");for(var s=0;s<coords.length;s++){coords[s]=parseFloat(coords[s])}var q=this.getAttribute("shape").toLowerCase().substr(0,4);if(q==="poly"){var r=m.getContext("2d");r.beginPath();r.moveTo(coords[0],coords[1]);for(s=2;s<coords.length;s+=2){r.lineTo(coords[s],coords[s+1])}r.lineWidth=2;r.closePath();r.strokeStyle="rgb(100,149,237)";r.stroke()}else{if(q==="rect"){var r=m.getContext("2d");r.beginPath();r.rect(coords[0],coords[1],coords[2]-coords[0],coords[3]-coords[1]);r.lineWidth=2;r.closePath();r.strokeStyle="rgb(100,149,237)";r.stroke()}}});f(l).find("area").bind("mouseover",g.mouseover).bind("mouseout",g.mouseout)}}p.data("imagecanvasmap",{options:g,clickX:k,clickY:i,canvas:m})}})},draw:function(){return this.each(function(){var g=f(this).data("imagecanvasmap");g.options.draw=true})},clear:function(){return this.each(function(){var g=f(this).data("imagecanvasmap");g.canvas.getContext("2d").clearRect(0,0,g.canvas.width,g.canvas.height)})}};f.fn.imagecanvasmap=function(g){if(b[g]){return b[g].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof g==="object"||!g){return b.init.apply(this,arguments)}else{f.error("Method "+g+" does not exist on jQuery.imagecanvasmap")}}};f.fn.imagecanvasmap.defaults={onComplete:function(){},mouseover:function(){},mouseout:function(){},draw:false}})(jQuery);